# imports
import os
import pandas as pd

# Load the metadata file
metadata = pd.read_csv('sradone.txt', usecols=['Run'], sep='\t')
# Create a list of run ids
reads = metadata['Run'].tolist()
# Define samples
READS = config.get('reads', reads)

# final output
rule all:
    input:
        expand('sig_files/sketch_reads/{read}.sig.gz', read=READS)

# sketch
rule sketch_read:
    input:
       fq='../atlas/atlas_{read}/{read}/sequence_quality_control/{read}_QC_R1.fastq.gz',
    output:
        sig='sig_files/sketch_reads/{read}.sig.gz',
    threads: 8
    shell:
        """
        module load parallel
        sourmash sketch dna \
        {input.fq} -p abund,k=21,scaled=1000,k=31,scaled=1000,k=51,scaled=1000 \
        -o {output.sig} --name {wildcards.read} | parallel -j {threads}
        """


